{% extends 'base.html' %}
{% load static %}

{% block title %}الصفحة الرئيسية{% endblock %}

{% block extra_css %}
<style>
.container {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.welcome-section {
    background: linear-gradient(135deg, #04463b 0%, #0066cc 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
}

.welcome-section h1 {
    margin: 0 0 10px 0;
    font-size: 36px;
    font-weight: bold;
}

.welcome-section p {
    margin: 0;
    font-size: 18px;
    opacity: 0.9;
}

.role-badge {
    display: inline-block;
    background-color: rgba(255,255,255,0.2);
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 14px;
    margin-top: 10px;
}

/* Dashboard Cards */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.dashboard-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 25px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-left: 4px solid #0066cc;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.dashboard-card h3 {
    margin: 0 0 15px 0;
    color: #04463b;
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.dashboard-card .icon {
    font-size: 24px;
    color: #0066cc;
}

.stat-number {
    font-size: 36px;
    font-weight: bold;
    color: #04463b;
    margin: 10px 0;
}

.stat-label {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
}

/* Quick Actions */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px 20px;
    background: #0066cc;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.action-btn:hover {
    background: #004080;
    color: white;
    text-decoration: none;
}

.action-btn.success {
    background: #28a745;
}

.action-btn.success:hover {
    background: #1e7e34;
}

.action-btn.warning {
    background: #ffc107;
    color: #333;
}

.action-btn.warning:hover {
    background: #e0a800;
}

/* Recent Activity */
.recent-activity {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 25px;
    margin-top: 30px;
}

.recent-activity h3 {
    margin: 0 0 20px 0;
    color: #04463b;
    display: flex;
    align-items: center;
    gap: 10px;
}

.activity-item {
    display: flex;
    justify-content: between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-info {
    flex: 1;
}

.activity-info h6 {
    margin: 0 0 5px 0;
    color: #04463b;
}

.activity-info small {
    color: #666;
}

.activity-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
}

.status-active {
    background: #d4edda;
    color: #155724;
}

.status-completed {
    background: #d1ecf1;
    color: #0c5460;
}

.status-setup {
    background: #fff3cd;
    color: #856404;
}

/* Committee Specific */
.current-evaluation {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    margin-bottom: 20px;
}

.candidate-info {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}

/* Anonymous User */
.info-section {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 30px;
    text-align: center;
    margin-bottom: 30px;
}

.info-section h2 {
    color: #04463b;
    margin-bottom: 15px;
}

.info-section p {
    color: #666;
    font-size: 16px;
    line-height: 1.6;
}

/* Plans Grid */
.plans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.plan-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 20px;
    transition: transform 0.3s ease;
}

.plan-card:hover {
    transform: translateY(-3px);
}

.plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 10px;
}

.plan-status.active {
    background-color: #d4edda;
    color: #155724;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
}

.plan-body p {
    margin: 8px 0;
    color: #555;
}

.plan-body strong {
    color: #04463b;
}

/* Responsive */
@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }

    .quick-actions {
        grid-template-columns: 1fr;
    }

    .plans-grid {
        grid-template-columns: 1fr;
    }

    .welcome-section h1 {
        font-size: 28px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        {% if user.is_authenticated %}
            <h1>مرحباً {{ user.get_full_name|default:user.username }}</h1>
            <p>
                {% if user_type == 'examiner' %}
                    مرحباً بك في لوحة تحكم المشرف - إدارة جلسات التقييم
                {% elif user_type == 'committee' %}
                    مرحباً بك في لوحة تحكم عضو اللجنة - تقييم المرشحين
                {% elif user_type == 'admin' %}
                    مرحباً بك في لوحة تحكم المدير - إدارة النظام
                {% else %}
                    مرحباً بك في النظام الآلي للاختبارات
                {% endif %}
            </p>
            <span class="role-badge">
                {% if user_type == 'examiner' %}مشرف التقييم
                {% elif user_type == 'committee' %}عضو لجنة التقييم
                {% elif user_type == 'admin' %}مدير النظام
                {% else %}مستخدم{% endif %}
            </span>
        {% else %}
            <h1>المنظومة الآلية لاختبارات فرع المعلومات</h1>
            <p>نظام شامل لإدارة عمليات التوظيف والتقييم</p>
        {% endif %}
    </div>

    {% if user.is_authenticated %}
        {% if user_type == 'examiner' %}
            <!-- Examiner Dashboard -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-alt icon"></i>إجمالي الجلسات</h3>
                    <div class="stat-number">{{ total_sessions }}</div>
                    <div class="stat-label">جلسة تقييم</div>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-play-circle icon"></i>الجلسات النشطة</h3>
                    <div class="stat-number">{{ active_sessions.count }}</div>
                    <div class="stat-label">جلسة نشطة حالياً</div>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-briefcase icon"></i>الخطط المتاحة</h3>
                    <div class="stat-number">{{ available_plans }}</div>
                    <div class="stat-label">خطة جاهزة للتقييم</div>
                </div>
            </div>

            <div class="quick-actions">
                <a href="{% url 'evaluation:plan_selection' %}" class="action-btn success">
                    <i class="fas fa-plus"></i>
                    إنشاء جلسة تقييم جديدة
                </a>
                <a href="{% url 'evaluation:session_list' %}" class="action-btn">
                    <i class="fas fa-list"></i>
                    إدارة الجلسات
                </a>
                <a href="{% url 'evaluation:question_list' %}" class="action-btn">
                    <i class="fas fa-clipboard-list"></i>
                    بنك الأسئلة
                </a>
            </div>

            {% if recent_sessions %}
            <div class="recent-activity">
                <h3><i class="fas fa-history icon"></i>النشاط الأخير</h3>
                {% for session in recent_sessions %}
                <div class="activity-item">
                    <div class="activity-info">
                        <h6>{{ session.plan.title }}</h6>
                        <small>{{ session.session_date }} - {{ session.get_status_display }}</small>
                    </div>
                    <span class="activity-status
                        {% if session.status == 'active' %}status-active
                        {% elif session.status == 'completed' %}status-completed
                        {% else %}status-setup{% endif %}">
                        {{ session.get_status_display }}
                    </span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

        {% elif user_type == 'committee' %}
            <!-- Committee Dashboard -->
            {% if has_active_session %}
                <div class="current-evaluation">
                    <h2><i class="fas fa-clipboard-check"></i> جلسة تقييم نشطة</h2>
                    <p>{{ current_session.plan.title }}</p>
                    {% if current_candidate %}
                        <div class="candidate-info">
                            <h4>المرشح الحالي: {{ current_candidate.student_name }}</h4>
                            <p>جاهز للتقييم</p>
                        </div>
                    {% endif %}
                    <div class="quick-actions">
                        <a href="{% url 'evaluation:committee_current_candidate' %}" class="action-btn" style="background: white; color: #28a745;">
                            <i class="fas fa-arrow-left"></i>
                            الانتقال للتقييم
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="info-section">
                    <h2><i class="fas fa-pause-circle"></i> لا توجد جلسات نشطة</h2>
                    <p>انتظر بدء جلسة تقييم من قبل المشرف</p>
                </div>
            {% endif %}

        {% elif user_type == 'admin' %}
            <!-- Admin Dashboard -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-briefcase icon"></i>خطط التوظيف</h3>
                    <div class="stat-number">{{ total_plans }}</div>
                    <div class="stat-label">خطة إجمالية</div>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-alt icon"></i>جلسات التقييم</h3>
                    <div class="stat-number">{{ total_sessions }}</div>
                    <div class="stat-label">جلسة إجمالية</div>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-play-circle icon"></i>الجلسات النشطة</h3>
                    <div class="stat-number">{{ active_sessions.count }}</div>
                    <div class="stat-label">جلسة نشطة</div>
                </div>
            </div>

            <div class="quick-actions">
                <a href="{% url 'evaluation:examiner_dashboard' %}" class="action-btn">
                    <i class="fas fa-cogs"></i>
                    إدارة التقييم
                </a>
                <a href="{% url 'students:plan_create' %}" class="action-btn success">
                    <i class="fas fa-plus"></i>
                    إنشاء خطة جديدة
                </a>
                <a href="{% url 'accounts:admin_dashboard' %}" class="action-btn warning">
                    <i class="fas fa-users-cog"></i>
                    إدارة المستخدمين
                </a>
            </div>

        {% else %}
            <!-- Default User Dashboard -->
            <div class="info-section">
                <h2>الخطط النشطة</h2>
                <p>تصفح خطط التوظيف المتاحة حالياً</p>
            </div>

            {% if active_plans %}
                <div class="plans-grid">
                    {% for plan in active_plans %}
                        <div class="plan-card">
                            <div class="plan-header">
                                <h4>{{ plan.title }}</h4>
                                <span class="plan-status active">نشطة</span>
                            </div>
                            <div class="plan-body">
                                <p><strong>القسم:</strong> {{ plan.department }}</p>
                                <p><strong>عدد المتقدمين:</strong> {{ plan.candidates_count }}</p>
                                <p><strong>تاريخ الإنشاء:</strong> {{ plan.created_at|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endif %}

    {% else %}
        <!-- Anonymous User Content -->
        <div class="info-section">
            <h2>نظام إدارة الاختبارات والتقييم</h2>
            <div class="quick-actions">
                <a href="{% url 'accounts:signing' %}" class="action-btn success">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </a>
            </div>
        </div>

        {% if active_plans %}
            <div class="recent-activity">
                <h3><i class="fas fa-briefcase icon"></i>الخطط المتاحة</h3>
                {% for plan in active_plans %}
                <div class="activity-item">
                    <div class="activity-info">
                        <h6>{{ plan.title }}</h6>
                        <small>{{ plan.department }} - {{ plan.candidates_count }} مرشح</small>
                    </div>
                    <span class="activity-status status-active">نشطة</span>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}